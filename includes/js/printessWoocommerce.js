let initPrintessWCEditor=function(f){let m="form.cart",d=null;if(void 0!==window.printessWooEditor)return window.printessWooEditor;function l(e,t,r,n){function i(e,t){(e=document.getElementById(e))&&(e.value=t)}i("printess-save-token",e),t&&i("printess-thumbnail-url",t),r&&i("printess-design-id",r),n&&i("printess-design-name",n)}function i(g){let v={templateNameOrSaveToken:g.templateNameOrSaveToken||g.product.templateName,stickers:[],legalText:g.legalText||"",legalTextUrl:g.legalUrl||"",snippetPrices:[],chargeEachStickerUsage:!1,hidePricesInEditor:void 0!==f.showPricesInEditor&&!1===f.showPricesInEditor,getProductName:()=>(void 0===f.showProductName||!1!==f.showProductName)&&g.product&&g.product.name||"",getPriceInfo:()=>null,getMergeTemplates:()=>{let e=[];if(g.mergeTemplates)if("string"==typeof g.mergeTemplates)try{var t=JSON.parse(g.mergeTemplates);if(!Array.isArray(t))return[];e=[...e,...t.map(e=>"string"==typeof e?{templateName:e}:e)]}catch(e){return[]}else e=[...e,...g.mergeTemplates.map(e=>"string"==typeof e?{templateName:e}:e)];return e=g.product.mergeTemplates?[...e,...g.product.mergeTemplates.map(e=>"string"==typeof e?{templateName:e}:e)]:e},formatMoney:e=>f.priceFormatOptions?(!0===f.priceFormatOptions.currencySymbolOnLeftSide?f.priceFormatOptions.currencySymbol:"")+n(""+e,2,f.priceFormatOptions.decimalSeperator,f.priceFormatOptions.thousandsSeperator)+(!0!==f.priceFormatOptions.currencySymbolOnLeftSide?f.priceFormatOptions.currencySymbol:""):parseFloat(""+e).toFixed(2),onFormFieldChanged:(t,n,e,i)=>{var r=c(g.product);let s=t;r[t]?s=r[t].key:r[e]&&(s=r[e].key);var r=y(),a=(r&&r.pricePerUsageFields&&(Array.isArray(r.pricePerUsageFields)?(a=r.pricePerUsageFields.filter(e=>e.formFieldName===t))&&0<a.length&&(0<(o=parseInt(n))?(d=d||{})[a[0].formFieldName]=o:d[a[0].formFieldName]&&delete d[a[0].formFieldName]):r.pricePerUsageFields[t]&&(0<(o=parseInt(n))?(d=d||{})[t]=o:d[t]&&delete d[t])),document.querySelectorAll('input[type="radio"][name="attribute_'+s+'"], input[type="radio"][name="'+s+'"],input[type="radio"][name="attribute_'+e+'"], input[type="radio"][name="'+e+'"]'));if(a&&0<a.length)a.forEach(e=>{e.getAttribute("value")===n||e.getAttribute("value")===i?(e.setAttribute("checked",(!0).toString()),e.checked=!0):(e.removeAttribute("checked"),e.checked=!1)});else{r=document.querySelectorAll('select[name="attribute_'+s+'"],select[name="'+s+'"],select[name="attribute_'+e+'"],select[name="'+e+'"]');if(r&&0<r.length)r.forEach(t=>{if(t.options)for(let e=0;e<t.options.length;++e){var r=t.options[e].getAttribute("value");n==r||i===r?(t.options[e].setAttribute("selected",(!0).toString()),t.options[e].selected=!0,t.setAttribute("value",r),t.value=r):(t.options[e].removeAttribute("selected"),t.options[e].selected=!1)}});else{var o=document.querySelectorAll('input[name="attribute_'+s+'"],input[name="'+s+'"],input[name="attribute_'+e+'"],input[name="'+e+'"]');let t=["color","date","datetime-local","email","month","number","tel","text","time","url","week"];o&&0<o.length&&o.forEach(e=>{-1<t.indexOf(e.getAttribute("type").toLowerCase())&&e.setAttribute("value",n)})}}},onAddToBasket:(e,n)=>{if("admin"===f.editorMode)w(e,n);else if(l(e,n,v.designId?.toString()??"",v.designName?.toString()??""),"buyer"===f.editorMode&&f.addToCartAfterCustomization){var i=document.querySelector(m),s=i.querySelector("[name=add-to-cart]"),a=h(g.product);let t=b(a,g.product),r=new URLSearchParams(window.location.search);t&&document.getElementsByName("variation_id").forEach(e=>e.setAttribute("value",t.id.toString())),s.hasAttribute("disabled")&&s.removeAttribute("disabled"),i&&f.cartUrl&&(void 0!==g.basketItemId&&g.basketItemId||(r.has("design_id")||r.has("design_name"))&&(r.get("design_id")||r.get("design_name")))?(i.setAttribute("action",f.cartUrl),(a=document.createElement("input")).setAttribute("id","printess_ignore_redirect"),a.setAttribute("name","printess_ignore_redirect"),a.value="true",i.appendChild(a)):(a=document.getElementById("printess_ignore_redirect"))&&a.remove(),i&&d&&((a=document.createElement("input")).setAttribute("id","printess_item_usage"),a.setAttribute("name","printess_item_usage"),a.value=JSON.stringify(d),i.appendChild(a));try{var o=y();o&&"function"==typeof o.onAddToBasket&&o.onAddToBasket(e,n)}catch(e){console.error(e)}"submit"===s.type?s.click():i.submit();if(g.product.ajaxEnabled)return{executeBeforeClosing:()=>{if(!0===g.product.ajaxEnabled){let e="";g.product&&g.product.redirectUrl&&(e=g.product.redirectUrl),f.cartUrl&&void 0!==g.basketItemId&&g.basketItemId&&(e=f.cartUrl),(e=f.cartUrl&&(r.has("design_id")||r.has("design_name"))&&(r.get("design_id")||r.get("design_name"))?f.cartUrl:e)&&setTimeout(function(){window.location.href=e},200)}},waitUntilClosingMS:1e3}}},getCurrentFormFieldValues:()=>h(g.product),getPriceForFormFields:e=>{e=b(e,g.product);let r=e?parseFloat(e.price):g.product.price;var n=y();if(d&&n&&n.pricePerUsageFields){let t={};if(Array.isArray(n.pricePerUsageFields))for(let e=0;e<n.pricePerUsageFields.length;++e)t[n.pricePerUsageFields[e].formFieldName]=n.pricePerUsageFields[e].pricePerUsage;else t=n.pricePerUsageFields;for(var i in d)d.hasOwnProperty(i)&&t[i]&&(r+=d[i]*t[i])}return r},getFormFieldMappings:()=>{let e={};if(g.optionValueMappings&&"string"==typeof g.optionValueMappings)try{e=JSON.parse(g.optionValueMappings)}catch(e){console.error("Unable to parse form field mappings: "+e)}return e},onRenderFirstPageImage:e=>{if(v.cameFromSave&&v.lastSaveSaveToken){try{v.onSave(v.lastSaveSaveToken,e,!0)}catch(e){console.error(e)}v.cameFromSave=!1,v.lastSaveSaveToken=""}},onSave:(c,u,e=!1)=>{v.cameFromSave=!0,v.lastSaveSaveToken=c;let m=h(g.product),p=b(m,g.product);if(e){if("admin"===f.editorMode)return void w(c,u);let o=()=>{},d=e=>{var t,r,n;e&&e.trim()?(t=f.userMessages&&f.userMessages.savingDesign?f.userMessages.savingDesign:"Saving design to your list of saved designs",(n=document.getElementById("printess_information_overlay_background"))&&((r=document.getElementById("printess_information_overlay_text"))&&(r.innerHTML=t),n.classList.add("visible"),n.getAttribute("data-initialized")||(n.setAttribute("data-initialized","true"),document.body.appendChild(n))),((e,t,r,n,i,s,a,o)=>{e={saveToken:e,thumbnailUrl:t,productId:r,displayName:n,options:JSON.stringify(s)};"string"==typeof i&&i?(t=parseInt(i),!isNaN(t)&&0<t&&(e.designId=t)):"number"==typeof i&&i&&!isNaN(i)&&0<i&&(e.designId=i),fetch("/index.php/wp-json/printess/v1/design/add",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":f.nonce},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)}).then(e=>(e.ok?e.json().then(e=>{"function"==typeof a&&a(n,e)}):(console.error(e.statusText),"function"==typeof o&&o(f.userMessages&&f.userMessages.saveError?f.userMessages.saveError:"There was an error while trying to save your design")),e)).catch(function(e){console.log(e),"function"==typeof o&&o(f.userMessages&&f.userMessages.saveError?f.userMessages.saveError:"There was an error while trying to save your design")})})(c,u,g.product.id,e,v.designId,h(g.product,!1),(e,t)=>{s(),v.designName=e,v.designId=t;try{var r=y();r&&"function"==typeof r.onSave&&r.onSave(c,u)}catch(e){console.error(e)}},e=>{s(),alert(e),_(v.designName,f.userIsLoggedIn?d:l,o)})):(alert(f.userMessages&&f.userMessages.noDisplayName?f.userMessages.noDisplayName:"Please provide a display name."),_(v.designName,f.userIsLoggedIn?d:l,o))},l=e=>{var t,r,n,i,s,a;[t,r,n,i,s,a=null]=[e,g.product.id,p?p.id:null,c,u,m],t&&t.trim()&&f.accountPageUrl?(r=f.accountPageUrl.replace("__ProductId__",""+r.toString()).replace("__SaveToken__",""+i).replace("__ThumbnailUrl__",encodeURIComponent(s)).replace("__VariantId__",""+n).replace("__Options__",encodeURIComponent(JSON.stringify(a??{}))).replace("__Token__",encodeURIComponent(f.urlToken||"")).replace("__DisplayName__",""+t.trim()),window.location.href=r):(alert(f.userMessages&&f.userMessages.noDisplayName?f.userMessages.noDisplayName:"Please provide a display name."),_(e,f.userIsLoggedIn?d:l,o))};_(v.designName,f.userIsLoggedIn?d:l,o)}else((e,t)=>{let r=document.getElementById("printess");r&&setTimeout(function(){r.contentWindow.postMessage({cmd:e,properties:t||{}},"*")},0)})("renderFirstPageImage",null)},getBasketId:()=>g.basketId,getUserId:()=>g.userId,editorClosed:e=>{var t;a.hide(),v.designId=null,v.designName=null,e&&l("","","",""),"buyer"===f.editorMode?"undefined"!=typeof URLSearchParams&&(t=new URLSearchParams(window.location.search),e&&t.has("design_id")||t.has("design_name")||t.has("printess-save-token"))&&(t.delete("design_id"),t.delete("design_name"),t.delete("printess-save-token"),window.location.search=t.toString()):(e=f.userMessages&&f.userMessages.closeWindow?f.userMessages.closeWindow:"Please close this window or tab.",alert(e))}};var e=h(g.product);(e=b(e,g.product))&&e.templateName&&(v.templateNameOrSaveToken=e.templateName);var t=(e=new URLSearchParams(window.location.search)).get("printess-save-token")||e.get("printess_save_token"),r=e.get("design_name"),e=e.get("design_id");return t&&(v.templateNameOrSaveToken=t),r&&(v.designName=r),e&&(v.designId=parseInt(e)),v}function p(e){let t="";var r=b(h(e),e),n=!(!e.variants||void 0===e.variants.find(e=>e.templateName));(t=null!=r&&r.templateName?r.templateName:t)||n||(t=e.templateName),v(t&&0<t.length)}function g(r){window.jQuery?window.jQuery("form").on("found_variation",(e,t)=>{p(r)}):setTimeout(g,100)}let y=()=>window&&window.printessGlobalConfig?window.printessGlobalConfig:{},h=function(t,r=!0){var n={},e={"add-to-cart":!0,product_id:!0,quantity:!0,variation_id:!0},i=y();if(i&&i.formFields)for(var s in i.formFields)i.hasOwnProperty(s)&&(n[s]=i.formFields[s]);function a(e){return r&&0===e.indexOf("attribute_")&&(e=e.substring(10,e.length)),e=t.attributes&&t.attributes[e]?t.attributes[e].name:e}var o,d=document.querySelector(m);if(d){for(o of new FormData(d).entries()){var l=a(o[0]);0<l.length&&"_"!==l[0]&&!e[l]&&0!==l.indexOf("printess-")&&(n[l]=o[1].toString())}var c,u=d.querySelectorAll('input[type="checkbox"]');if(u&&0<u.length)for(let e=0;e<u.length;++e)void 0!==u[e].checked&&!0===u[e].checked&&0<(c=a(u[e].name)).length&&"_"!==c[0]&&(n[c]="true")}return n},c=e=>{var t={};if(e&&e.attributes)for(var r in e.attributes)e.attributes.hasOwnProperty(r)&&(t[e.attributes[r].name]=e.attributes[r]);return t},b=function(e,t){let r=t.variants?t.variants[0]:null;var n,i=c(t),s=[];for(n in e)e.hasOwnProperty(n)&&i[n]&&s.push({key:i[n].key,value:e[n]});if(t.variants){let e=t.variants;s.forEach(t=>{e=e.filter(e=>e.attributes[t.key]===t.value)}),0<e.length&&(r=e[0])}return r},u=()=>{var e=document.getElementById("printess_overlay_background");e&&e.classList.remove("visible")},_=(e,r,t)=>{var n=document.getElementById("printess_show_if_not_logged_in");let i=document.getElementById("printess_overlay_background"),s=()=>{},a=e=>{e.srcElement&&("input"===e.srcElement.nodeName.toLowerCase()||null!=e.srcElement.closest("div.printess_overlay_background"))||(e.preventDefault(),e.stopPropagation())},o=()=>{if(u(),s(),"function"==typeof r){let e="";var t=document.getElementById("printess_designnameedit");t&&(e=t.value),r(e)}},d=()=>{u(),s(),"function"==typeof t&&t()};s=()=>{var e=document.getElementById("printess_save_design_button"),e=(e&&e.removeEventListener("click",o),document.getElementById("printess_cancel_button"));e&&e.removeEventListener("click",d),i&&(i.removeEventListener("mousedown",a),i.removeEventListener("mouseup",a),i.removeEventListener("mousemove",a))},n&&(f.userIsLoggedIn?n.classList.add("logged_in"):n.classList.remove("logged_in"));var n=document.getElementById("printess_show_if_no_design_name"),l=document.getElementById("printess_show_if_design_name"),n=(n&&l&&(e?(n.classList.remove("visible"),l.classList.add("visible")):(n.classList.add("visible"),l.classList.remove("visible"))),document.getElementById("printess_designnameedit")),l=(n&&(n.value=e||""),i&&(i.addEventListener("mousedown",a),i.addEventListener("mouseup",a),i.addEventListener("mousemove",a),i.getAttribute("data-initialized")||(document.body.appendChild(i),i.setAttribute("data-initialized","true")),i.classList.add("visible")),document.getElementById("printess_save_design_button")),n=(l&&l.addEventListener("click",o),document.getElementById("printess_cancel_button"));n&&n.addEventListener("click",d)},s=()=>{var e=document.getElementById("printess_information_overlay_background");e&&e.classList.remove("visible")},w=(e,t)=>{var r=document.getElementById("printess-admin-save"),n=document.getElementById("printess-loading-message"),i=document.getElementById("printess-saving-message");n?.style.setProperty("display","none"),i?.style.setProperty("display","block"),r?(r.href+="&pst="+e,r.href+="&ptu="+encodeURI(t),r.click()):alert("Error: Redirect link not found. Unable to save changes")},n=(e,t,r,n)=>{e=(e+"").replace(/[^0-9+\-Ee.]/g,"");e=isFinite(+e)?+e:0,t=isFinite(+t)?Math.abs(t):0,n=void 0===n?",":n,r=void 0===r?".":r,e=(t?((e,t)=>(t=Math.pow(10,t),""+Math.round(e*t)/t))(e,t):""+Math.round(e)).split(".");return 3<e[0].length&&(e[0]=e[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,n)),(e[1]||"").length<t&&(e[1]=e[1]||"",e[1]+=new Array(t-e[1].length+1).join("0")),e.join(r)},v=function(t){var e=document.getElementsByName("printess-customize-button"),r=document.querySelector(m+" button.single_add_to_cart_button");e&&0!==e.length&&(r&&(t?r.setAttribute("disabled","disabled"):r.removeAttribute("disabled"),r.style.display=t?"none":"inline-block"),e.forEach(e=>e.style.display=t?"inline-block":"none"))},a={show:function(e){if(d=null,!(e=>{var t,r,n=c(e),i=[],s=h(e);for(t in s)s.hasOwnProperty(t)&&n[t]&&i.push({key:n[t].key,value:s[t]});for(r in i)if(i.hasOwnProperty(r)&&!i[r].value)return!0;return!1})(e.product)){e&&e.templateNameOrSaveToken&&e.templateNameOrSaveToken.startsWith("st:")&&(t=document.getElementById("printess-save-token-to-remove-from-cart"))&&(t.value=e.templateNameOrSaveToken);var t=i(e),r=(f.idsToHide&&f.idsToHide.forEach(e=>{e=document.getElementById(e);e&&e.classList.add("printess-hide")}),f.classesToHide&&f.classesToHide.forEach(e=>{e=document.getElementsByClassName(e);if(e&&e.length)for(var t of e)t.classList.add("printess-hide")}),y());if(r&&r.attachParams)for(var n in r.attachParams)r.attachParams.hasOwnProperty(n)&&(f.attachParams||(f.attachParams={}),f.attachParams[n]=r.attachParams[n]);"function"==typeof window.initPrintessEditor&&window.initPrintessEditor(f).show(t)}},hide:function(){f.idsToHide.forEach(e=>{e=document.getElementById(e);e&&e.classList.remove("printess-hide")}),f.classesToHide.forEach(e=>{e=document.getElementsByClassName(e);if(e&&e.length)for(var t of e)t.classList.remove("printess-hide")})},initProductPage:function(e,r,n,i="Customize",t,s=m){s=document.querySelector(s||m);if(s){{var a=r;var o=document.createElement("input"),d=document.createElement("input"),l=document.createElement("input"),c=document.createElement("input"),u=document.createElement("input");let t=document.createElement("button");o.setAttribute("id","printess-save-token"),o.setAttribute("name","printess-save-token"),o.setAttribute("type","hidden"),d.setAttribute("id","printess-save-token-to-remove-from-cart"),d.setAttribute("name","printess-save-token-to-remove-from-cart"),d.setAttribute("type","hidden"),d.setAttribute("value",a||""),l.setAttribute("id","printess-thumbnail-url"),l.setAttribute("name","printess-thumbnail-url"),l.setAttribute("type","hidden"),c.setAttribute("id","printess-design-id"),c.setAttribute("name","printess-design-id"),c.setAttribute("type","hidden"),u.setAttribute("id","printess-design-name"),u.setAttribute("name","printess-design-name"),u.setAttribute("type","hidden"),t.setAttribute("id","printess-customize-button"),t.setAttribute("name","printess-customize-button"),t.setAttribute("type","button"),t.setAttribute("onclick","showPrintessEditor();"),t.classList.add("wp-element-button","single_add_to_cart_button","button","alt"),f.customizeButtonClasses&&f.customizeButtonClasses.split(" ").forEach(e=>{(e=(e||"").trim())&&t.classList.add(e)}),t.appendChild(document.createTextNode(i||"Customize")),n&&t.classList.add(n),((a=document.querySelector(m+" button.single_add_to_cart_button"))&&a.parentElement?a.parentElement:s).appendChild(t),s.appendChild(o),s.appendChild(d),s.appendChild(l),s.appendChild(c),s.appendChild(u)}r&&v(!0)}g(e),p(e);i=new URLSearchParams(window.location.search),n=i.get("printess-save-token"),a=i.get("printess_item_key");n&&"function"==typeof t&&t(n,a)}};return window.printessWooEditor=a};if(window.wc&&window.wc.blocksCheckout){let e=window.wc.blocksCheckout.registerCheckoutFilters,a=(e,t,r,n)=>{let i=(e||document).querySelector("."+t);return i||((i=document.createElement(r)).classList.add(t),n&&i.classList.add(n),e.appendChild(i)),i};e("printess-editor",{cartItemClass:(e,s,t)=>{let r=e||"";if(s&&s["printess-editor"]&&s["printess-editor"].saveToken&&t.cartItem){let e="printess_cart_item_"+t.cartItem.key;r+=" "+e+" ",setTimeout(function(){var t=document.querySelector("."+e);if(s["printess-editor"].designName){let e=t?t.querySelector("ul.wc-block-components-product-details"):null;e||(i=t.querySelector(".wc-block-cart-item__wrap"))&&(i=a(i,"wc-block-components-product-metadata","div"),e=a(i,"wc-block-components-product-details","ul")),e&&((i=e.querySelector(".printess-product-detail-name"))?(i.innerText="Design name: ",(i=e.querySelector("printess-product-detail-name"))&&(i.innerText=s["printess-editor"].designName)):((i=document.createElement("li")).classList.add("wc-block-components-product-details__designName"),i.classList.add("printess-product-details-item"),r=a(i,"wc-block-components-product-details__name","span","printess-product-detail-name"),n=a(i,"wc-block-components-product-details__value","span","printess-product-detail-value"),r.innerText="Design name: ",n.innerText=s["printess-editor"].designName,e.appendChild(i)))}var r=t?.querySelector(".wc-block-cart-item__image img");if(r&&(r.classList.add("printess-thumbnail-image"),r.setAttribute("src",s["printess-editor"].thumbnailUrl)),s["printess-editor"].thumbnailUrl){var n=t?.querySelector(".wc-block-cart-item__image a"),i=(n&&n.setAttribute("href",s["printess-editor"].editLink),t?.querySelector(".wc-block-cart-item__quantity"));if(i){let e=i.querySelector(".printess-edit-link");e||((e=document.createElement("a")).classList.add("wc-block-cart-item__remove-link"),e.classList.add("printess-edit-link"),e.innerText="Edit",(r=document.createElement("div")).appendChild(e),i.appendChild(r)),e.setAttribute("href",s["printess-editor"].editLink)}}},0)}return r}})}