const initPrintessWCEditor=function(f){const m="form.cart";if(void 0!==window.printessWooEditor)return window.printessWooEditor;function d(e,t,n){function r(e,t){(e=document.getElementById(e))&&(e.value=t)}r("printess-save-token",e),t&&r("printess-thumbnail-url",t),n&&r("printess-design-id",n)}function r(g){const v={templateNameOrSaveToken:g.templateNameOrSaveToken||g.product.templateName,stickers:[],legalText:g.legalText||"",legalTextUrl:g.legalUrl||"",snippetPrices:[],chargeEachStickerUsage:!1,hidePricesInEditor:void 0!==f.showPricesInEditor&&!1===f.showPricesInEditor,getProductName:()=>(void 0===f.showProductName||!1!==f.showProductName)&&(g.product&&g.product.name)||"",getPriceInfo:()=>null,getMergeTemplates:()=>{let e=[];if(g.mergeTemplates)if("string"==typeof g.mergeTemplates)try{var t=JSON.parse(g.mergeTemplates);if(!Array.isArray(t))return[];e=[...e,...t.map(e=>"string"==typeof e?{templateName:e}:e)]}catch(e){return[]}else e=[...e,...g.mergeTemplates.map(e=>"string"==typeof e?{templateName:e}:e)];return e=g.product.mergeTemplates?[...e,...g.product.mergeTemplates.map(e=>"string"==typeof e?{templateName:e}:e)]:e},formatMoney:e=>f.priceFormatOptions?(!0===f.priceFormatOptions.currencySymbolOnLeftSide?f.priceFormatOptions.currencySymbol:"")+((e,t,n,r)=>{e=(e+"").replace(/[^0-9+\-Ee.]/g,"");e=isFinite(+e)?+e:0,t=isFinite(+t)?Math.abs(t):0,r=void 0===r?",":r,n=void 0===n?".":n,e=(t?function(e,t){t=Math.pow(10,t);return""+Math.round(e*t)/t}(e,t):""+Math.round(e)).split(".");return 3<e[0].length&&(e[0]=e[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,r)),(e[1]||"").length<t&&(e[1]=e[1]||"",e[1]+=new Array(t-e[1].length+1).join("0")),e.join(n)})(""+e,2,f.priceFormatOptions.decimalSeperator,f.priceFormatOptions.thousandsSeperator)+(!0!==f.priceFormatOptions.currencySymbolOnLeftSide?f.priceFormatOptions.currencySymbol:""):parseFloat(""+e).toFixed(2),onFormFieldChanged:(e,r,t,s)=>{var n=a(g.product);let i=e;n[e]?i=n[e].key:n[t]&&(i=n[t].key);e=document.querySelectorAll('input[type="radio"][name="attribute_'+i+'"], input[type="radio"][name="'+i+'"],input[type="radio"][name="attribute_'+t+'"], input[type="radio"][name="'+t+'"]');if(e&&0<e.length)e.forEach(e=>{e.getAttribute("value")===r||e.getAttribute("value")===s?(e.setAttribute("checked",(!0).toString()),e.checked=!0):(e.removeAttribute("checked"),e.checked=!1)});else{n=document.querySelectorAll('select[name="attribute_'+i+'"],select[name="'+i+'"],select[name="attribute_'+t+'"],select[name="'+t+'"]');if(n&&0<n.length)n.forEach(t=>{if(t.options)for(let e=0;e<t.options.length;++e){var n=t.options[e].getAttribute("value");r==n||s===n?(t.options[e].setAttribute("selected",(!0).toString()),t.options[e].selected=!0,t.setAttribute("value",n),t.value=n):(t.options[e].removeAttribute("selected"),t.options[e].selected=!1)}});else{e=document.querySelectorAll('input[name="attribute_'+i+'"],input[name="'+i+'"],input[name="attribute_'+t+'"],input[name="'+t+'"]');const o=["color","date","datetime-local","email","month","number","tel","text","time","url","week"];e&&0<e.length&&e.forEach(e=>{-1<o.indexOf(e.getAttribute("type").toLowerCase())&&e.setAttribute("value",r)})}}},onAddToBasket:(e,t)=>{if("admin"===f.editorMode)w(e,t);else if(d(e,t,v.designId?.toString()??""),"buyer"===f.editorMode&&f.addToCartAfterCustomization){var n=document.querySelector(m),r=n.querySelector("[name=add-to-cart]"),s=h(g.product);const o=b(s,g.product),a=new URLSearchParams(window.location.search);o&&document.getElementsByName("variation_id").forEach(e=>e.setAttribute("value",o.id.toString())),r.hasAttribute("disabled")&&r.removeAttribute("disabled"),n&&f.cartUrl&&(void 0!==g.basketItemId&&g.basketItemId||(a.has("design_id")||a.has("design_name"))&&(a.get("design_id")||a.get("design_name")))?(n.setAttribute("action",f.cartUrl),(s=document.createElement("input")).setAttribute("id","printess_ignore_redirect"),s.setAttribute("name","printess_ignore_redirect"),s.value="true",n.appendChild(s)):(s=document.getElementById("printess_ignore_redirect"))&&s.remove();try{var i=y();i&&"function"==typeof i.onAddToBasket&&i.onAddToBasket(e,t)}catch(e){console.error(e)}"submit"===r.type?r.click():n.submit();return{executeBeforeClosing:()=>{if(!0===g.product.ajaxEnabled){let e="";g.product&&g.product.redirectUrl&&(e=g.product.redirectUrl),f.cartUrl&&void 0!==g.basketItemId&&g.basketItemId&&(e=f.cartUrl),(e=f.cartUrl&&(a.has("design_id")||a.has("design_name"))&&(a.get("design_id")||a.get("design_name"))?f.cartUrl:e)&&setTimeout(function(){window.location.href=e},200)}},waitUntilClosingMS:1e3}}},getCurrentFormFieldValues:()=>h(g.product),getPriceForFormFields:e=>{e=b(e,g.product);return e?parseFloat(e.price):g.product.price},getFormFieldMappings:()=>{let e={};if(g.optionValueMappings&&"string"==typeof g.optionValueMappings)try{e=JSON.parse(g.optionValueMappings)}catch(e){console.error("Unable to parse form field mappings: "+e)}return e},onRenderFirstPageImage:e=>{if(v.cameFromSave&&v.lastSaveSaveToken){try{v.onSave(v.lastSaveSaveToken,e,!0)}catch(e){console.error(e)}v.cameFromSave=!1,v.lastSaveSaveToken=""}},onSave:(d,l,e=!1)=>{v.cameFromSave=!0,v.lastSaveSaveToken=d;const a=h(g.product),c=b(a,g.product);if(e){if("admin"===f.editorMode)return void w(d,l);const u=()=>{},m=e=>{var t,n,r,s,i,o,a;e&&e.trim()?(n=f.userMessages&&f.userMessages.savingDesign?f.userMessages.savingDesign:"Saving design to your list of saved designs",(r=document.getElementById("printess_information_overlay_background"))&&((t=document.getElementById("printess_information_overlay_text"))&&(t.innerHTML=n),r.classList.add("visible"),r.getAttribute("data-initialized")||(r.setAttribute("data-initialized","true"),document.body.appendChild(r))),t=d,n=l,r=g.product.id,s=e,e=v.designId,i=h(g.product,!1),o=(e,t)=>{E(),v.designName=e,v.designId=t;try{var n=y();n&&"function"==typeof n.onSave&&n.onSave(d,l)}catch(e){console.error(e)}},a=e=>{E(),alert(e),_(v.designName,f.userIsLoggedIn?m:p,u)},t={saveToken:t,thumbnailUrl:n,productId:r,displayName:s,options:JSON.stringify(i)},"string"==typeof e&&e?(n=parseInt(e),!isNaN(n)&&0<n&&(t.designId=n)):"number"==typeof e&&e&&!isNaN(e)&&0<e&&(t.designId=e),fetch("/index.php/wp-json/printess/v1/design/add",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":f.nonce},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)}).then(e=>(e.ok?e.json().then(e=>{"function"==typeof o&&o(s,e)}):(console.error(e.statusText),"function"==typeof a&&a(f.userMessages&&f.userMessages.saveError?f.userMessages.saveError:"There was an error while trying to save your design")),e)).catch(function(e){console.log(e),"function"==typeof a&&a(f.userMessages&&f.userMessages.saveError?f.userMessages.saveError:"There was an error while trying to save your design")})):(alert(f.userMessages&&f.userMessages.noDisplayName?f.userMessages.noDisplayName:"Please provide a display name."),_(v.designName,f.userIsLoggedIn?m:p,u))},p=e=>{var t,n,r,s,i,o;[t,n,r,s,i,o=null]=[e,g.product.id,c?c.id:null,d,l,a],t&&t.trim()&&f.accountPageUrl?(n=f.accountPageUrl.replace("__ProductId__",""+n.toString()).replace("__SaveToken__",""+s).replace("__ThumbnailUrl__",encodeURIComponent(i)).replace("__VariantId__",""+r).replace("__Options__",encodeURIComponent(JSON.stringify(o??{}))).replace("__Token__",encodeURIComponent(f.urlToken||"")).replace("__DisplayName__",""+t.trim()),window.location.href=n):(alert(f.userMessages&&f.userMessages.noDisplayName?f.userMessages.noDisplayName:"Please provide a display name."),_(e,f.userIsLoggedIn?m:p,u))};_(v.designName,f.userIsLoggedIn?m:p,u)}else{var t="renderFirstPageImage";var n=null;const r=document.getElementById("printess");r&&setTimeout(function(){r.contentWindow.postMessage({cmd:t,properties:n||{}},"*")},0)}},getBasketId:()=>g.basketId,getUserId:()=>g.userId,editorClosed:e=>{var t;s.hide(),v.designId=null,v.designName=null,e&&d("","",""),"buyer"===f.editorMode?"undefined"!=typeof URLSearchParams&&(t=new URLSearchParams(window.location.search),e&&t.has("design_id")||t.has("design_name")||t.has("printess-save-token"))&&(t.delete("design_id"),t.delete("design_name"),t.delete("printess-save-token"),window.location.search=t.toString()):(e=f.userMessages&&f.userMessages.closeWindow?f.userMessages.closeWindow:"Please close this window or tab.",alert(e))}};var e=h(g.product);(e=b(e,g.product))&&e.templateName&&(v.templateNameOrSaveToken=e.templateName);var t=(e=new URLSearchParams(window.location.search)).get("printess-save-token")||e.get("printess_save_token"),n=e.get("design_name"),e=e.get("design_id");return t&&(v.templateNameOrSaveToken=t),n&&(v.designName=n),e&&(v.designId=parseInt(e)),v}function p(e){let t="";var n=b(h(e),e),r=!(!e.variants||void 0===e.variants.find(e=>e.templateName));(t=null!=n&&n.templateName?n.templateName:t)||r||(t=e.templateName),v(t&&0<t.length)}function g(n){window.jQuery?window.jQuery("form").on("found_variation",(e,t)=>{p(n)}):setTimeout(g,100)}const y=()=>window&&window.printessGlobalConfig?window.printessGlobalConfig:{},h=function(t,n=!0){var r={},e={"add-to-cart":!0,product_id:!0,quantity:!0,variation_id:!0},s=y();if(s&&s.formFields)for(const c in s.formFields)s.hasOwnProperty(c)&&(r[c]=s.formFields[c]);function i(e){return n&&0===e.indexOf("attribute_")&&(e=e.substring(10,e.length)),e=t.attributes&&t.attributes[e]?t.attributes[e].name:e}var o=document.querySelector(m);if(o){for(const u of new FormData(o).entries()){var a=i(u[0]);0<a.length&&"_"!==a[0]&&!e[a]&&0!==a.indexOf("printess-")&&(r[a]=u[1].toString())}var d,l=o.querySelectorAll('input[type="checkbox"]');if(l&&0<l.length)for(let e=0;e<l.length;++e)void 0!==l[e].checked&&!0===l[e].checked&&0<(d=i(l[e].name)).length&&"_"!==d[0]&&(r[d]="true")}return r},a=e=>{var t={};if(e&&e.attributes)for(const n in e.attributes)e.attributes.hasOwnProperty(n)&&(t[e.attributes[n].name]=e.attributes[n]);return t},b=function(e,t){let n=t.variants?t.variants[0]:null;var r=a(t),s=[];for(const i in e)e.hasOwnProperty(i)&&r[i]&&s.push({key:r[i].key,value:e[i]});if(t.variants){let e=t.variants;s.forEach(t=>{e=e.filter(e=>e.attributes[t.key]===t.value)}),0<e.length&&(n=e[0])}return n},c=()=>{var e=document.getElementById("printess_overlay_background");e&&e.classList.remove("visible")},_=(e,n,t)=>{var r=document.getElementById("printess_show_if_not_logged_in");const s=document.getElementById("printess_overlay_background");let i=()=>{};const o=e=>{e.srcElement&&("input"===e.srcElement.nodeName.toLowerCase()||null!=e.srcElement.closest("div.printess_overlay_background"))||(e.preventDefault(),e.stopPropagation())},a=()=>{if(c(),i(),"function"==typeof n){let e="";var t=document.getElementById("printess_designnameedit");t&&(e=t.value),n(e)}},d=()=>{c(),i(),"function"==typeof t&&t()};i=()=>{var e=document.getElementById("printess_save_design_button"),e=(e&&e.removeEventListener("click",a),document.getElementById("printess_cancel_button"));e&&e.removeEventListener("click",d),s&&(s.removeEventListener("mousedown",o),s.removeEventListener("mouseup",o),s.removeEventListener("mousemove",o))},r&&(f.userIsLoggedIn?r.classList.add("logged_in"):r.classList.remove("logged_in"));var r=document.getElementById("printess_show_if_no_design_name"),l=document.getElementById("printess_show_if_design_name"),r=(r&&l&&(e?(r.classList.remove("visible"),l.classList.add("visible")):(r.classList.add("visible"),l.classList.remove("visible"))),document.getElementById("printess_designnameedit")),l=(r&&(r.value=e||""),s&&(s.addEventListener("mousedown",o),s.addEventListener("mouseup",o),s.addEventListener("mousemove",o),s.getAttribute("data-initialized")||(document.body.appendChild(s),s.setAttribute("data-initialized","true")),s.classList.add("visible")),document.getElementById("printess_save_design_button")),r=(l&&l.addEventListener("click",a),document.getElementById("printess_cancel_button"));r&&r.addEventListener("click",d)},E=()=>{var e=document.getElementById("printess_information_overlay_background");e&&e.classList.remove("visible")},w=(e,t)=>{var n=document.getElementById("printess-admin-save"),r=document.getElementById("printess-loading-message"),s=document.getElementById("printess-saving-message");r?.style.setProperty("display","none"),s?.style.setProperty("display","block"),n?(n.href+="&pst="+e,n.href+="&ptu="+encodeURI(t),n.click()):alert("Error: Redirect link not found. Unable to save changes")},v=function(t){var e=document.getElementsByName("printess-customize-button"),n=document.querySelector(m+" button.single_add_to_cart_button");e&&0!==e.length&&(n&&(t?n.setAttribute("disabled","disabled"):n.removeAttribute("disabled"),n.style.display=t?"none":"inline-block"),e.forEach(e=>e.style.display=t?"inline-block":"none"))},s={show:function(e){if(!(e=>{var t=a(e),n=[],r=h(e);for(const s in r)r.hasOwnProperty(s)&&t[s]&&n.push({key:t[s].key,value:r[s]});for(const i in n)if(n.hasOwnProperty(i)&&!n[i].value)return!0;return!1})(e.product)){var e=r(e),t=(f.idsToHide&&f.idsToHide.forEach(e=>{e=document.getElementById(e);e&&e.classList.add("printess-hide")}),f.classesToHide&&f.classesToHide.forEach(e=>{e=document.getElementsByClassName(e);if(e&&e.length)for(const t of e)t.classList.add("printess-hide")}),y());if(t&&t.attachParams)for(const n in t.attachParams)t.attachParams.hasOwnProperty(n)&&(f.attachParams||(f.attachParams={}),f.attachParams[n]=t.attachParams[n]);"function"==typeof window.initPrintessEditor&&window.initPrintessEditor(f).show(e)}},hide:function(){f.idsToHide.forEach(e=>{e=document.getElementById(e);e&&e.classList.remove("printess-hide")}),f.classesToHide.forEach(e=>{e=document.getElementsByClassName(e);if(e&&e.length)for(const t of e)t.classList.remove("printess-hide")})},initProductPage:function(e,t,n,r="Customize",s,i=m){i=document.querySelector(i||m);if(i){{var o=t;var a=document.createElement("input"),d=document.createElement("input"),l=document.createElement("input"),c=document.createElement("input");const u=document.createElement("button");a.setAttribute("id","printess-save-token"),a.setAttribute("name","printess-save-token"),a.setAttribute("type","hidden"),d.setAttribute("id","printess-save-token-to-remove-from-cart"),d.setAttribute("name","printess-save-token-to-remove-from-cart"),d.setAttribute("type","hidden"),d.setAttribute("value",o||""),l.setAttribute("id","printess-thumbnail-url"),l.setAttribute("name","printess-thumbnail-url"),l.setAttribute("type","hidden"),c.setAttribute("id","printess-design-id"),c.setAttribute("name","printess-design-id"),c.setAttribute("type","hidden"),u.setAttribute("id","printess-customize-button"),u.setAttribute("name","printess-customize-button"),u.setAttribute("type","button"),u.setAttribute("onclick","showPrintessEditor();"),u.classList.add("wp-element-button","single_add_to_cart_button","button","alt"),f.customizeButtonClasses&&f.customizeButtonClasses.split(" ").forEach(e=>{(e=(e||"").trim())&&u.classList.add(e)}),u.appendChild(document.createTextNode(r||"Customize")),n&&u.classList.add(n);o=document.querySelector(m+" button.single_add_to_cart_button");(o&&o.parentElement?o.parentElement:i).appendChild(u),i.appendChild(a),i.appendChild(d),i.appendChild(l),i.appendChild(c)}t&&v(!0)}g(e),p(e);r=new URLSearchParams(window.location.search).get("printess-save-token");r&&"function"==typeof s&&s(r)}};return window.printessWooEditor=s};